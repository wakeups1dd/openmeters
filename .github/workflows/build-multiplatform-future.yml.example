# EXAMPLE: Future multi-platform workflow
# This is just a reference - DON'T use this yet!
# Keep using build.yml until you add Linux/macOS support

name: Build OpenMeters (Multi-Platform)

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  # Windows build (current - keep this!)
  build-windows:
    name: Build Windows x64
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Configure CMake
      run: cmake -B build -G "Visual Studio 17 2022" -A x64
      shell: cmd
      
    - name: Build Release
      run: cmake --build build --config Release
      shell: cmd
      
    - name: Upload artifact
      uses: actions/upload-artifact@v4
      with:
        name: openmeters-windows-x64
        path: build/bin/Release/openmeters.exe

  # Linux build (add this when you implement PulseAudio capture)
  build-linux:
    name: Build Linux x64
    runs-on: ubuntu-latest
    if: false  # Disabled until Linux support is added
    
    steps:
    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y libpulse-dev cmake build-essential
    
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Configure CMake
      run: cmake -B build -G "Unix Makefiles"
      
    - name: Build
      run: cmake --build build --config Release
      
    - name: Upload artifact
      uses: actions/upload-artifact@v4
      with:
        name: openmeters-linux-x64
        path: build/bin/openmeters

  # macOS build (add this when you implement CoreAudio capture)
  build-macos:
    name: Build macOS
    runs-on: macos-latest
    if: false  # Disabled until macOS support is added
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Configure CMake
      run: cmake -B build -G "Xcode"
      
    - name: Build
      run: cmake --build build --config Release
      
    - name: Upload artifact
      uses: actions/upload-artifact@v4
      with:
        name: openmeters-macos
        path: build/bin/Release/openmeters

  # Alternative: Matrix build (cleaner when all platforms are ready)
  # build:
  #   name: Build ${{ matrix.platform }}
  #   runs-on: ${{ matrix.os }}
  #   strategy:
  #     matrix:
  #       include:
  #         - platform: Windows
  #           os: windows-latest
  #           generator: "Visual Studio 17 2022"
  #         - platform: Linux
  #           os: ubuntu-latest
  #           generator: "Unix Makefiles"
  #         - platform: macOS
  #           os: macos-latest
  #           generator: "Xcode"



